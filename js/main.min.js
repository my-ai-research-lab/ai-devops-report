/**
 * AI × 研发效能 - 极致优化版
 * 压缩并优化的JS代码
 */
(function(){'use strict';let a=!1;function b(){const e=document.querySelectorAll('.nav-links a[href^="#"]');e.forEach(n=>{n.addEventListener('click',function(t){t.preventDefault();const o=this.getAttribute('href'),r=document.querySelector(o);if(r){const i=document.querySelector('.nav')?.offsetHeight||0,s=r.getBoundingClientRect().top+window.pageYOffset-i;window.scrollTo({top:s,behavior:'smooth'})}},{passive:!1})})}function c(){if(!('IntersectionObserver'in window))return;if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelectorAll('.animate-on-scroll').forEach(e=>{e.style.opacity='1';e.style.transform='none'});return}const e=new IntersectionObserver(t=>{t.forEach(o=>{o.isIntersecting&&(o.target.classList.add('is-visible'),e.unobserve(o.target))})},{threshold:.1,rootMargin:'0px 0px -50px 0px'});requestAnimationFrame(()=>{document.querySelectorAll('.card,.insight-card,.ranking-card,.maturity-card,.evolution-step,.layer-card,.timeline-item').forEach((t,o)=>{t.style.cssText=`opacity:0;transform:translateY(20px);transition:opacity .5s ease ${o*.03}s,transform .5s ease ${o*.03}s`;t.classList.add('animate-on-scroll');e.observe(t)})})}function d(){const e=document.querySelectorAll('section[id]'),n=document.querySelectorAll('.nav-links a[href^="#"]');if(!e.length||!n.length)return;let t=[];function o(){t=Array.from(e).map(s=>({id:s.getAttribute('id'),top:s.offsetTop,bottom:s.offsetTop+s.offsetHeight}))}function r(){const s=window.scrollY+100;for(const l of t){if(s>=l.top&&s<l.bottom){n.forEach(u=>{u.classList.toggle('active',u.getAttribute('href')==='#'+l.id)});break}}}let i=!1;window.addEventListener('scroll',()=>{i||(window.requestAnimationFrame(()=>{r();i=!1}),i=!0)},{passive:!0});let h;window.addEventListener('resize',()=>{clearTimeout(h);h=setTimeout(o,250)},{passive:!0});o();r()}function f(){const e=document.querySelectorAll('[data-tip]');if(!e.length)return;let n=document.querySelector('.tooltip-global');n||(n=document.createElement('div'),n.className='tooltip tooltip-global',n.style.cssText='position:fixed;background:rgba(0,0,0,.9);color:#fff;padding:.5rem .75rem;border-radius:4px;font-size:.75rem;max-width:250px;z-index:10000;pointer-events:none;opacity:0;transition:opacity .2s;visibility:hidden',document.body.appendChild(n));let t=null;function o(i){const s=i.currentTarget.getAttribute('data-tip');s&&(t=i.currentTarget,n.textContent=s,n.style.visibility='visible',n.style.opacity='1',r(i))}function h(){n.style.opacity='0';n.style.visibility='hidden';t=null}function r(i){const s=i.currentTarget.getBoundingClientRect(),l=n.getBoundingClientRect();let u=s.top-l.height-8,p=s.left+s.width/2-l.width/2;u<0&&(u=s.bottom+8);p<8&&(p=8);p+l.width>window.innerWidth-8&&(p=window.innerWidth-l.width-8);n.style.top=u+'px';n.style.left=p+'px'}e.forEach(i=>{i.addEventListener('mouseenter',o,{passive:!0});i.addEventListener('mouseleave',h,{passive:!0})})}function g(){if(a)return;a=!0;c();d();const e=window.matchMedia('(prefers-reduced-motion: reduce)');document.documentElement.classList.toggle('reduced-motion',e.matches);e.addEventListener('change',n=>{document.documentElement.classList.toggle('reduced-motion',n.matches)});f()}'requestIdleCallback'in window?requestIdleCallback(g,{timeout:2e3}):setTimeout(g,1);document.addEventListener('DOMContentLoaded',()=>{b();document.body.classList.add('loaded')});const m=document.createElement('style');m.textContent='.animate-on-scroll.is-visible{opacity:1!important;transform:translateY(0)!important}.reduced-motion *{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}';document.head.appendChild(m)})();
